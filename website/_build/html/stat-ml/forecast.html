
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Time Series Forecasting &#8212; Portfolio</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/math-aw.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time Series Reconstruction" href="reconstruct.html" />
    <link rel="prev" title="Farmer’s Fridge Yelp Reviews Analysis" href="ff_yelp.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Portfolio</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../preface.html">
                    Preface
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Deploying Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../deploy/churn.html">
   Predicting Churn with Amazon SageMaker
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics and Machine Learning
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ff_yelp.html">
   Farmer’s Fridge Yelp Reviews Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Time Series Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reconstruct.html">
   Time Series Reconstruction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resources.html">
   More Examples and Learning Resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/euler.html">
   Project Euler
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/stat-ml/forecast.py"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.py</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-source">
   Data Source
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-exploration">
   Data Exploration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-simple-forecast">
   Building a Simple Forecast
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimizing-the-forecast">
   Optimizing the Forecast
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Time Series Forecasting</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-source">
   Data Source
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-exploration">
   Data Exploration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-simple-forecast">
   Building a Simple Forecast
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimizing-the-forecast">
   Optimizing the Forecast
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="time-series-forecasting">
<span id="time-series"></span><h1>Time Series Forecasting<a class="headerlink" href="#time-series-forecasting" title="Permalink to this headline">#</a></h1>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>Using all recorded annual temperatures averages (from 1850 to 2020), I use <a class="reference external" href="https://facebook.github.io/prophet/">Prophet</a> to forecast annual temperatures for the next two decades.</p>
</section>
<section id="data-source">
<h2>Data Source<a class="headerlink" href="#data-source" title="Permalink to this headline">#</a></h2>
<p>Average northern hemisphere temperature data was obtained from <a class="reference external" href="https://www.metoffice.gov.uk/hadobs/hadcrut5/">https://www.metoffice.gov.uk/hadobs/hadcrut5/</a>, specifically the “HadCRUT5 analysis time series: ensemble means and uncertainties”.
The temperatures are expressed as deviations, or anomalies, from reference temperatures over the period of 1961–1990; for details <a class="reference external" href="https://crudata.uea.ac.uk/cru/data/temperature/#faq5">see here</a>.
Each anomaly is a best estimate calculated from an ensemble of 100 time series, hence confidence intervals are present in the dataset.
For the purposes of this analysis, I will just use the point estimate.</p>
</section>
<section id="data-exploration">
<span id="id1"></span><h2>Data Exploration<a class="headerlink" href="#data-exploration" title="Permalink to this headline">#</a></h2>
<p>Let’s load in the data and examine it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./globwarm.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Anomaly (deg C)</th>
      <th>Lower confidence limit (2.5%)</th>
      <th>Upper confidence limit (97.5%)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>-0.435791</td>
      <td>-0.635680</td>
      <td>-0.235902</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1851</td>
      <td>-0.219249</td>
      <td>-0.428398</td>
      <td>-0.010100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1852</td>
      <td>-0.235702</td>
      <td>-0.457689</td>
      <td>-0.013715</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Anomaly (deg C)</th>
      <th>Lower confidence limit (2.5%)</th>
      <th>Upper confidence limit (97.5%)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>169</th>
      <td>2019</td>
      <td>1.143743</td>
      <td>1.108290</td>
      <td>1.179197</td>
    </tr>
    <tr>
      <th>170</th>
      <td>2020</td>
      <td>1.275727</td>
      <td>1.236863</td>
      <td>1.314590</td>
    </tr>
    <tr>
      <th>171</th>
      <td>2021</td>
      <td>1.004906</td>
      <td>0.764207</td>
      <td>1.245604</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Since 2021 data collection is still ongoing, the confidence limits are much wider.
For simplicity, I’ll drop this point from the analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Time</span> <span class="o">&lt;=</span> <span class="mi">2020</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s plot the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Anomaly (deg C)&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/forecast_8_0.png" src="../_images/forecast_8_0.png" />
</div>
</div>
<p>There is also clearly a nonlinear trend amidst the random variation from year to year.
We also expect some long term cyclical patterns, for instance <a class="reference external" href="https://en.wikipedia.org/wiki/Milankovitch_cycles">Milankovitch cycles</a> due to variations in Earth’s movement relative to the Sun.
However, these patterns are difficult to extract because we have just under 200 years of data to work with.
These cyclical patterns are very important, however, because we don’t have access to more granular data with daily, weekly, and/or yearly variation typically present in business problems.
For this reason, <a class="reference external" href="https://facebook.github.io/prophet/">Prophet</a> is useful as it can easily implement custom seasonalities.
It’s also flexible in its ability to detect changepoints, another crucial parameter affecting model fit as we will see next.</p>
</section>
<section id="building-a-simple-forecast">
<h2>Building a Simple Forecast<a class="headerlink" href="#building-a-simple-forecast" title="Permalink to this headline">#</a></h2>
<p>First, we must format the data appropriately.
Prophet expects a two column dataframe with datestamps <code class="docutils literal notranslate"><span class="pre">ds</span></code> formatted like <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DD</span></code> and numeric data <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_years</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert numeric years to YYYY-MM-DD format, using an arbitrary day.&quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-12-31&quot;</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ds</span>

<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Anomaly (deg C)&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="s2">&quot;Anomaly (deg C)&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">format_years</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850-12-31</td>
      <td>-0.435791</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1851-12-31</td>
      <td>-0.219249</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1852-12-31</td>
      <td>-0.235702</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>168</th>
      <td>2018-12-31</td>
      <td>0.959662</td>
    </tr>
    <tr>
      <th>169</th>
      <td>2019-12-31</td>
      <td>1.143743</td>
    </tr>
    <tr>
      <th>170</th>
      <td>2020-12-31</td>
      <td>1.275727</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code> is now ready for Prophet modeling, but as hinted in § <a class="reference internal" href="#data-exploration"><span class="std std-ref">Data Exploration</span></a>, a model built from defaults performs very poorly:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>The INFO messages tell us weekly and daily seasonalities are disabled (by default) as they should be, because our data resolution is on much longer timescales.</p>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prophet</span> <span class="kn">import</span> <span class="n">Prophet</span>

<span class="k">def</span> <span class="nf">plot_model_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fit and plot predictions of a Prophet() model on the training data.&quot;&quot;&quot;</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">()</span>
<span class="n">plot_model_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Importing plotly failed. Interactive plots will not work.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:prophet:Disabling weekly seasonality. Run prophet with weekly_seasonality=True to override this.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:prophet:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -17.5035
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       217.559   0.000640947       66.6814           1           1      128   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     188       218.511    0.00158703       88.0943   2.803e-05       0.001      286  LS failed, Hessian reset 
     199       218.616   5.91156e-05       56.8093     0.07449           1      306   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     292       218.705   2.68884e-05       64.9809   3.837e-07       0.001      470  LS failed, Hessian reset 
     299       218.705   5.18845e-06       67.2586           1           1      478   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     334       218.706   2.36909e-06        77.496   3.097e-08       0.001      563  LS failed, Hessian reset 
     342       218.706   1.90175e-09       66.7851     0.03287     0.03287      575   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<img alt="../_images/forecast_13_5.png" src="../_images/forecast_13_5.png" />
</div>
</div>
<p>The reason is that we need to account for long term cycles over many years.
A yearly seasonality is meaningless in this context, because we don’t have sub-year level data.
Let’s try again, disabling the usual seasonalities and implementing our own using the <code class="docutils literal notranslate"><span class="pre">add_seasonality()</span></code> method.
From the scatterplot of the raw data, any noticeable variation occurs after at least 50 years.
At this scale, the variation is relatively small, so the fit shouldn’t be too flexible.
In other words, we shouldn’t include too many Fourier terms, controlled by the <code class="docutils literal notranslate"><span class="pre">fourier_order</span></code> parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
    <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="s1">&#39;50 years&#39;</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="n">fourier_order</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_model_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -17.5035
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      53       218.827     0.0054749       100.245   5.445e-05       0.001       94  LS failed, Hessian reset 
      86       219.303   0.000428905       65.8946   5.252e-06       0.001      191  LS failed, Hessian reset 
      99       219.314   7.47284e-06       41.2342      0.5794      0.5794      211   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     160       219.835   0.000219902       48.0568   4.058e-06       0.001      343  LS failed, Hessian reset 
     193       219.863   0.000114599       67.8428   1.766e-06       0.001      422  LS failed, Hessian reset 
     199       219.865    2.8985e-06       48.9324      0.2933      0.2933      429   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     219       219.866   1.76065e-06         49.44   3.818e-08       0.001      492  LS failed, Hessian reset 
     234       219.866   9.82303e-09        50.957     0.09921     0.09921      514   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<img alt="../_images/forecast_15_2.png" src="../_images/forecast_15_2.png" />
</div>
</div>
<p>The fit’s a bit better in terms of smoothness, but still not great.
Increasing <code class="docutils literal notranslate"><span class="pre">fourier_order</span></code> just amounts to more more variation around a similar mean trend line.
Let’s try increasing the seasonality period a bit more:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
    <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="s1">&#39;centuryly&#39;</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">fourier_order</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_model_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -17.5035
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      95       248.116   5.36108e-05       42.8226   8.505e-07       0.001      168  LS failed, Hessian reset 
      99       248.117   5.87883e-06       49.9379      0.8928     0.08928      175   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     158       248.125   4.68896e-07        57.519   8.193e-09       0.001      306  LS failed, Hessian reset 
     163       248.125   8.11851e-09       51.7867      0.1544      0.1544      312   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<img alt="../_images/forecast_17_2.png" src="../_images/forecast_17_2.png" />
</div>
</div>
<p>The fit is much better.
Let’s see what it forecasts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">future</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<img alt="../_images/forecast_19_1.png" src="../_images/forecast_19_1.png" />
</div>
</div>
<p>The model stays roughly linear with the latest data, but levels off due to the seasonality built into the model.</p>
</section>
<section id="optimizing-the-forecast">
<h2>Optimizing the Forecast<a class="headerlink" href="#optimizing-the-forecast" title="Permalink to this headline">#</a></h2>
<p>The previous hand-tuning was insightful, but largely experimental.
A more principled approach tunes the parameters based on some performance metric(s).
Cross-validation is often used for this, but we have to be a bit careful with time series data due to correlations between data points.
One approach preserves the ordering of time by training on the first (say) 100 years of data and testing on the next 20 years of data.
Then we train on the first 110 years of data and again test on the next 20 years of data.
We repeat this until we reach the end of the data.
Each batch gives us an estimate of errors of predictions made 1, 2, …, 20 years in the future while preserving the ordering of time.
This approach can be implemented in Prophet as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prophet.diagnostics</span> <span class="kn">import</span> <span class="n">cross_validation</span>

<span class="n">df_cv</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="s1">&#39;36500 days&#39;</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="s1">&#39;7300 days&#39;</span><span class="p">)</span>
<span class="n">df_cv</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:prophet:Making 6 forecasts with cutoffs between 1951-01-18 00:00:00 and 2001-01-05 00:00:00
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "922f52ad9ab04c5e869ef60efec3ee7f"}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -5.25924
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      75       127.229   9.68385e-10       101.584     0.09599     0.09599       96   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -5.36242
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       139.461   9.76843e-05       103.123      0.7929      0.7929      120   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     143       139.524   4.58751e-05       102.166   4.693e-07       0.001      204  LS failed, Hessian reset 
     168       139.527    7.1662e-09       100.937      0.1476      0.1476      239   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -5.73025
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       153.794   3.71888e-06       105.159       0.349           1      126   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     138       153.795   7.36488e-09       106.455      0.4683      0.4683      176   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -6.64014
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      82       164.752   0.000308592       101.842   3.108e-06       0.001      141  LS failed, Hessian reset 
      99       164.769   1.70261e-06       99.5116      0.5224      0.5224      162   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     117       164.769   8.94213e-09       99.2085       0.177       0.177      184   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -14.1508
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      88       163.574      0.001071       107.114   9.956e-06       0.001      160  LS failed, Hessian reset 
      99       163.666   0.000165312       102.358      0.9734      0.9734      172   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     182       163.726   6.51677e-09       95.6481      0.2608      0.2608      276   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -12.6326
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       151.557   4.53253e-06       54.8127      0.5863      0.5863      139   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     174       151.578   5.73067e-05       84.3149   7.726e-07       0.001      277  LS failed, Hessian reset 
     199        151.58   2.07059e-07       47.3968      0.3915      0.3915      310   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     232        151.58   6.29633e-09       67.7881      0.2082           1      358   
Optimization terminated normally: 
  Convergence detected: absolute parameter change was below tolerance
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>yhat</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
      <th>y</th>
      <th>cutoff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1951-12-31</td>
      <td>-0.006353</td>
      <td>-0.163867</td>
      <td>0.151059</td>
      <td>0.053849</td>
      <td>1951-01-18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1952-12-31</td>
      <td>-0.015820</td>
      <td>-0.165441</td>
      <td>0.132568</td>
      <td>0.069817</td>
      <td>1951-01-18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1953-12-31</td>
      <td>-0.025520</td>
      <td>-0.184239</td>
      <td>0.126971</td>
      <td>0.206579</td>
      <td>1951-01-18</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cv</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>yhat</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
      <th>y</th>
      <th>cutoff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>117</th>
      <td>2018-12-31</td>
      <td>0.104307</td>
      <td>-0.094205</td>
      <td>0.287713</td>
      <td>0.959662</td>
      <td>2001-01-05</td>
    </tr>
    <tr>
      <th>118</th>
      <td>2019-12-31</td>
      <td>0.115870</td>
      <td>-0.088734</td>
      <td>0.319167</td>
      <td>1.143743</td>
      <td>2001-01-05</td>
    </tr>
    <tr>
      <th>119</th>
      <td>2020-12-31</td>
      <td>0.129318</td>
      <td>-0.075923</td>
      <td>0.337947</td>
      <td>1.275727</td>
      <td>2001-01-05</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For example, we see the the first <code class="docutils literal notranslate"><span class="pre">cutoff</span></code> point is in 1960.
The model is trained on data up until the cutoff, then predictions (<code class="docutils literal notranslate"><span class="pre">yhat</span></code>) are made for the next 20 years.
The cutoff points are then incremented by 10 years until 2000.
I’ll measure model performance using mean squared error (MSE), but a variety of metrics could be used.
We can plot MSE as a function of horizon length (how far in time the prediction is made) using <code class="docutils literal notranslate"><span class="pre">plot_cross_validation_metric()</span></code>;
unsurprisingly, performance is worse the farther out the window:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prophet.plot</span> <span class="kn">import</span> <span class="n">plot_cross_validation_metric</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_cross_validation_metric</span><span class="p">(</span><span class="n">df_cv</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">rolling_window</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">plot_cross_validation_metric</span><span class="p">(</span><span class="n">df_cv</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">rolling_window</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                             <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/forecast_24_0.png" src="../_images/forecast_24_0.png" />
</div>
</div>
<p>The two curves differ by the amount of averaging used in computing the MSE.
Each point in the blue curved is averaged over 10% of the data while the orange curve is averaged over 50% of the data.
The blue curve is more variable but can give estimates over shorter horizons.
Setting <code class="docutils literal notranslate"><span class="pre">rolling_window=1</span></code> averages over all the data, giving just a single average estimate for the MSE predicting within a 20 year horizon.
A dataframe of metrics can be extracted with <code class="docutils literal notranslate"><span class="pre">performance_metrics()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prophet.diagnostics</span> <span class="kn">import</span> <span class="n">performance_metrics</span>

<span class="n">df_performance</span> <span class="o">=</span> <span class="n">performance_metrics</span><span class="p">(</span><span class="n">df_cv</span><span class="p">,</span> <span class="n">rolling_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>horizon</th>
      <th>mse</th>
      <th>rmse</th>
      <th>mae</th>
      <th>mape</th>
      <th>mdape</th>
      <th>smape</th>
      <th>coverage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7300 days</td>
      <td>0.225348</td>
      <td>0.474709</td>
      <td>0.358713</td>
      <td>3.293734</td>
      <td>1.071312</td>
      <td>1.544548</td>
      <td>0.375</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The above code with <code class="docutils literal notranslate"><span class="pre">rolling_window=1</span></code> is useful for hyperparameter tuning.
It allows us to optimizing average performance over a fixed horizon window.
This is done in the code below to find the optimum seasonality period and number of Fourier terms.
I also optimize over two model parameters <code class="docutils literal notranslate"><span class="pre">changepoint_prior_scale</span></code> and <code class="docutils literal notranslate"><span class="pre">seasonality_prior_scale</span></code> which control the flexibility of the changepoints and seasonalities.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>This cell takes a while to run so is not executable, but later cells that analyze <code class="docutils literal notranslate"><span class="pre">tuning_results.csv</span></code> are executable.</p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">make_grid_combinations</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turn a dictionary of grid points into a dictionary of all combinations</span>
<span class="sd">    of those grid points.&quot;&quot;&quot;</span>
    <span class="n">all_params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">grid</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">all_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">vals</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">all_params</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;period&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;fourier_order&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="s1">&#39;changepoint_prior_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.005</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="mf">.5</span><span class="p">],</span>
    <span class="s1">&#39;seasonality_prior_scale&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">all_params</span> <span class="o">=</span> <span class="n">make_grid_combinations</span><span class="p">(</span><span class="n">param_grid</span><span class="p">)</span>
<span class="n">mses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Cross-validate each combination of grid parameters to estimate MSEs</span>
<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">all_params</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
        <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">yearly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">changepoint_prior_scale</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;changepoint_prior_scale&#39;</span><span class="p">],</span>
        <span class="n">seasonality_prior_scale</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;seasonality_prior_scale&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; year&#39;</span><span class="p">,</span>
        <span class="n">period</span> <span class="o">=</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span>
        <span class="n">fourier_order</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fourier_order&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df_cv</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="s1">&#39;36500 days&#39;</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="s1">&#39;7300 days&#39;</span><span class="p">)</span>
    <span class="n">df_performance</span> <span class="o">=</span> <span class="n">performance_metrics</span><span class="p">(</span><span class="n">df_cv</span><span class="p">,</span> <span class="n">rolling_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_performance</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">tuning_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_params</span><span class="p">)</span>
<span class="n">tuning_results</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mses</span>
<span class="n">tuning_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;tuning_results.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is stored in a dataframe of cross-validated MSEs and the parameters used in the model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuning_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./tuning_results.csv&#39;</span><span class="p">)</span>
<span class="n">tuning_results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>period</th>
      <th>fourier_order</th>
      <th>changepoint_prior_scale</th>
      <th>seasonality_prior_scale</th>
      <th>mse</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>2</td>
      <td>0.005</td>
      <td>0.1</td>
      <td>0.154416</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>2</td>
      <td>0.005</td>
      <td>1.0</td>
      <td>0.155571</td>
    </tr>
    <tr>
      <th>2</th>
      <td>50</td>
      <td>2</td>
      <td>0.005</td>
      <td>10.0</td>
      <td>0.156148</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>2</td>
      <td>0.050</td>
      <td>0.1</td>
      <td>0.152661</td>
    </tr>
    <tr>
      <th>4</th>
      <td>50</td>
      <td>2</td>
      <td>0.050</td>
      <td>1.0</td>
      <td>0.154947</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>76</th>
      <td>100</td>
      <td>6</td>
      <td>0.050</td>
      <td>1.0</td>
      <td>0.243489</td>
    </tr>
    <tr>
      <th>77</th>
      <td>100</td>
      <td>6</td>
      <td>0.050</td>
      <td>10.0</td>
      <td>0.245329</td>
    </tr>
    <tr>
      <th>78</th>
      <td>100</td>
      <td>6</td>
      <td>0.500</td>
      <td>0.1</td>
      <td>0.108537</td>
    </tr>
    <tr>
      <th>79</th>
      <td>100</td>
      <td>6</td>
      <td>0.500</td>
      <td>1.0</td>
      <td>0.108298</td>
    </tr>
    <tr>
      <th>80</th>
      <td>100</td>
      <td>6</td>
      <td>0.500</td>
      <td>10.0</td>
      <td>0.106562</td>
    </tr>
  </tbody>
</table>
<p>81 rows × 5 columns</p>
</div></div></div>
</div>
<p>The best parameters, measured by MSE, are easily obtained:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">best_params</span> <span class="o">=</span> <span class="n">tuning_results</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">tuning_results</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">]),</span> <span class="p">:]</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>period                     75.000000
fourier_order               2.000000
changepoint_prior_scale     0.500000
seasonality_prior_scale    10.000000
mse                         0.048304
Name: 35, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Let’s see what the optimized model looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
    <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">yearly_seasonality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">changepoint_prior_scale</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span>
    <span class="n">seasonality_prior_scale</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="s1">&#39;centuryly&#39;</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">75</span><span class="p">,</span> <span class="n">fourier_order</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
/home/adam/projects/website/env/lib/python3.9/site-packages/prophet/forecaster.py:896: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  components = components.append(new_comp)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial log joint probability = -17.5035
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
      99       302.408    0.00570823       11.3782           1           1      120   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     119       303.216   0.000781285       20.5453   2.855e-05       0.001      185  LS failed, Hessian reset 
     199       304.138   7.30153e-05        7.3618      0.4801      0.4801      290   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     272       304.446   0.000393317       11.4501   2.713e-05       0.001      419  LS failed, Hessian reset 
     299       304.522   0.000217305       7.42838      0.3201      0.3201      452   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     346       304.735    0.00183216       21.7699   0.0001859       0.001      537  LS failed, Hessian reset 
     399       304.865   0.000122705       8.81822      0.3029           1      608   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     448       304.947   0.000699382       14.9056   8.463e-05       0.001      714  LS failed, Hessian reset 
     499       304.979   2.88487e-05       7.75454      0.3058      0.3058      774   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     551       304.984   0.000253777        7.0285   3.633e-05       0.001      887  LS failed, Hessian reset 
     599       304.986   9.19244e-06       7.14222           1           1      950   
    Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes 
     602       304.986   1.93406e-05       6.94598   2.726e-06       0.001      992  LS failed, Hessian reset 
     625       304.986   3.04125e-07       6.87252      0.4057           1     1021   
Optimization terminated normally: 
  Convergence detected: relative gradient magnitude is below tolerance
</pre></div>
</div>
<img alt="../_images/forecast_33_2.png" src="../_images/forecast_33_2.png" />
</div>
</div>
</section>
</section>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"221e57bfe32249b0ae10c6e67c99190e": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "de63adf5428847ab8982c484df000098": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "230055a8606f4c46986c7d5e8bb59f57": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_221e57bfe32249b0ae10c6e67c99190e", "max": 6.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_de63adf5428847ab8982c484df000098", "value": 6.0}}, "84a1da0e8a8c42c6a8549e2959eee0c7": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3c9a601ec9c94bcd9d11721bb7160101": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "8dbd471ce3de434e9c32ad8dbe521459": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_84a1da0e8a8c42c6a8549e2959eee0c7", "placeholder": "\u200b", "style": "IPY_MODEL_3c9a601ec9c94bcd9d11721bb7160101", "value": "100%"}}, "513f592afb06435583f973f5b97b894b": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "87a5071ee13a452fbdb25a05b3185f24": {"model_name": "DescriptionStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "0486b55fe1314c31a9b1233ce23e3b1d": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_513f592afb06435583f973f5b97b894b", "placeholder": "\u200b", "style": "IPY_MODEL_87a5071ee13a452fbdb25a05b3185f24", "value": " 6/6 [00:04&lt;00:00,  1.22it/s]"}}, "f91a0429c51f4028acf0c1a1509ba845": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "922f52ad9ab04c5e869ef60efec3ee7f": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_8dbd471ce3de434e9c32ad8dbe521459", "IPY_MODEL_230055a8606f4c46986c7d5e8bb59f57", "IPY_MODEL_0486b55fe1314c31a9b1233ce23e3b1d"], "layout": "IPY_MODEL_f91a0429c51f4028acf0c1a1509ba845"}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "adamwangdata/adamwangdata.github.io",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./stat-ml"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ff_yelp.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Farmer’s Fridge Yelp Reviews Analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="reconstruct.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Time Series Reconstruction</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Adam Wang<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>