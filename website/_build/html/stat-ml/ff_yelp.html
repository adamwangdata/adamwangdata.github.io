
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farmer’s Fridge Yelp Reviews Analysis &#8212; Portfolio</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/math-aw.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time Series Forecasting" href="forecast.html" />
    <link rel="prev" title="Predicting Churn with Amazon SageMaker" href="../deploy/churn.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Portfolio</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Deploying Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../deploy/churn.html">
   Predicting Churn with Amazon SageMaker
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistics and Machine Learning
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Farmer’s Fridge Yelp Reviews Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="forecast.html">
   Time Series Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reconstruct.html">
   Time Series Reconstruction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resources.html">
   More Examples and Learning Resources
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../python/euler.html">
   Project Euler
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/stat-ml/ff_yelp.py"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.py</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-source">
   Data Source
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-cleaning-and-exploration">
   Data Cleaning and Exploration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ratings-over-time">
     Ratings Over Time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-items-are-popular">
     What Items are Popular?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-phrases-are-common">
     What Phrases are Common?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#future-work">
   Future Work
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Farmer’s Fridge Yelp Reviews Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-source">
   Data Source
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-cleaning-and-exploration">
   Data Cleaning and Exploration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ratings-over-time">
     Ratings Over Time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-items-are-popular">
     What Items are Popular?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-phrases-are-common">
     What Phrases are Common?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#future-work">
   Future Work
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="farmer-s-fridge-yelp-reviews-analysis">
<span id="yelp"></span><h1>Farmer’s Fridge Yelp Reviews Analysis<a class="headerlink" href="#farmer-s-fridge-yelp-reviews-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Using data from 173 Yelp reviews for three major fridge locations, I examined trends like average ratings over time, item popularity, and common phrases mentioned in reviews.
The results show that, pre-pandemic:</p>
<ol class="simple">
<li><p>The airport location had more and, on average, better ratings while it was active</p></li>
<li><p>Salad popularity decreased over time while bowl and sandwich popularities increased, but salads are still by far the most popular type of item</p></li>
</ol>
<p>Common positive phrases include “healthy”, “good”, and “fresh”, while analysis of negative reviews suggests price and portion sizes factored into their low ratings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can run and modify the code on this page Jupyter Notebook style, but without leaving the page!
Hover over the <span class="fa fa-rocket"></span> launch button at the top of the page, then click the <span class="guilabel">Live Code</span> button.
Once you see “Launching from mybinder.org: ready”, you can run code cells.
Refresh the page to revert to the original view.</p>
</div>
</div>
<div class="section" id="data-source">
<h2>Data Source<a class="headerlink" href="#data-source" title="Permalink to this headline">¶</a></h2>
<p>I scraped Yelp reviews using the Selenium package on 6/20/2021.
Data include rating (1 out of 5 stars), the main text of the review, and metadata like the the number of Yelp reviews a user has given or the number of people who found a review useful.
Each review constitutes a row in the <code class="docutils literal notranslate"><span class="pre">yelp.csv</span></code> file, with each piece of data (rating, text, etc.) as a separate column.</p>
<p>I scraped three different Chicago fridges.
I found the locations by manually navigating Yelp’s website and searching for “farmer’s fridge” in Chicago and selecting fridges with &gt; 10 reviews.
The three fridges have <a class="reference external" href="https://www.yelp.com/biz/farmers-fridge-chicago-13">93 reviews</a>, <a class="reference external" href="https://www.yelp.com/biz/farmers-fridge-chicago-14">23 reviews</a>, and <a class="reference external" href="https://www.yelp.com/biz/farmers-fridge-chicago-87">57 reviews</a> for a total of 173 reviews.
Two fridges are located in The Loop, while the third location with 57 reviews is located in O’Hare International Airport.</p>
<p>My complete code to scrape the reviews can be toggled below, but is not the main focus of this writeup.</p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">scrape_reviews</span><span class="p">(</span><span class="n">yelp_url</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieve all text data from reviews, including star rating.</span>
<span class="sd">    Sleep between pages of reviews so the html loads before accessing data.&quot;&quot;&quot;</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yelp_url</span><span class="p">)</span>

    <span class="n">all_reviews</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">more_pages_exist</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">more_pages_exist</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Wait for page to load</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">get_reviews_on_page</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
        <span class="n">all_reviews</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>
        <span class="n">click_succeeded</span> <span class="o">=</span> <span class="n">click_on_next_page</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">click_succeeded</span><span class="p">:</span>
            <span class="n">more_pages_exist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">all_reviews</span>

<span class="k">def</span> <span class="nf">get_reviews_on_page</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract reviews on a Yelp page.&quot;&quot;&quot;</span>
    <span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">review_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">more_reviews_exist</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">more_reviews_exist</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">review</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span>
                <span class="s2">&quot;/html/body/div[2]/div[2]/yelp-react-root/div/div[3]/div/div&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/div[2]/div/div[1]/div[2]/section[2]/div[2]/div/ul&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/li[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">review_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/div&quot;</span>
            <span class="p">)</span>
            <span class="n">rating</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span>
                <span class="s2">&quot;/html/body/div[2]/div[2]/yelp-react-root/div/div[3]/div/div/&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;div[2]/div/div[1]/div[2]/section[2]/div[2]/div/ul&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/li[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">review_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;/div/div[2]/div/div[1]/span/div&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;aria-label&#39;</span><span class="p">)</span>

            <span class="n">reviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rating</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">review</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">review_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>  <span class="c1"># No more reviews on page</span>
            <span class="n">more_reviews_exist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">reviews</span>

<span class="k">def</span> <span class="nf">click_on_next_page</span><span class="p">(</span><span class="n">browser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Click on the next page of Yelp reviews, if it exists. Returns</span>
<span class="sd">    whether the next page exists.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">next_page_button</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span>
            <span class="s1">&#39;.next-link&#39;</span>
        <span class="p">)</span>
        <span class="n">next_page_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">write_to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">reviews</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the following data as columns in a csv file:</span>
<span class="sd">        - rating (1 to 5 scale)</span>
<span class="sd">        - reviewer data: name, location, number of friends, number of</span>
<span class="sd">            reviews, and number of photos</span>
<span class="sd">        - review data: date of review, updated or not, review text,</span>
<span class="sd">            number of people who found the review useful, funny, and cool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">append</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;rating&#39;</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;elite&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reviewer_location&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_friends&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_reviews&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_photos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;review_photos&#39;</span><span class="p">,</span>
                <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                <span class="s1">&#39;updated&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_useful&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_funny&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_cool&#39;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
                <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;restaurant_location&#39;</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">reviews</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">process_review</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_review</span><span class="p">(</span><span class="n">review</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process the structure of a Yelp review line by line into a row</span>
<span class="sd">    to be appended by the `write_to_csv()` function.&quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">rating</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Reviewer data</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_elite</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">elite</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elite</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">n_friends</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">n_reviews</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">n_photos</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_photos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Review data</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_updated_review</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span>
    <span class="k">if</span> <span class="n">has_photos</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">review_photos</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">has_photos</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">single</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">review_photos</span> <span class="o">=</span> <span class="n">strip_nonint</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;photos&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">review_photos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end_of_review_text</span> <span class="o">=</span> <span class="n">find_end_of_review_text</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">end_of_review_text</span><span class="p">])</span>
    <span class="n">n_useful</span> <span class="o">=</span> <span class="n">strip_nonint</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">end_of_review_text</span><span class="p">],</span> <span class="s1">&#39;Useful&#39;</span><span class="p">)</span>
    <span class="n">n_funny</span> <span class="o">=</span> <span class="n">strip_nonint</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">end_of_review_text</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Funny&#39;</span><span class="p">)</span>
    <span class="n">n_cool</span> <span class="o">=</span> <span class="n">strip_nonint</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">end_of_review_text</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Cool&#39;</span><span class="p">)</span>

    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">rating</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">elite</span><span class="p">,</span>
        <span class="n">location</span><span class="p">,</span>
        <span class="n">n_friends</span><span class="p">,</span>
        <span class="n">n_reviews</span><span class="p">,</span>
        <span class="n">n_photos</span><span class="p">,</span>
        <span class="n">review_photos</span><span class="p">,</span>
        <span class="n">date</span><span class="p">,</span>
        <span class="n">updated</span><span class="p">,</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">n_useful</span><span class="p">,</span>
        <span class="n">n_funny</span><span class="p">,</span>
        <span class="n">n_cool</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">find_end_of_review_text</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find which line the main text of a review ends.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Useful&#39;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">line2</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Funny&#39;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">line3</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Cool&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">i</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: no expected end of text found.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_elite</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine if given string is an elite Yelp user.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Elite&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_int</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine if given string is an integer.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">has_photos</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">single</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine if given string ends in &#39;photo&#39; or &#39;photos&#39;.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;photos&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_updated_review</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine if given string indicates an updated Yelp review.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;Updated review&quot;</span>

<span class="k">def</span> <span class="nf">strip_nonint</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">word_to_strip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Strip words and spaces from a string, keeping non-integer parts</span>
<span class="sd">    after stripping. If the remaining piece is not an integer, return &#39;0&#39;.</span>
<span class="sd">    So, &#39;Useful 12&#39; becomes &#39;12&#39; while &#39;Useful&#39; becomes &#39;0&#39;.&quot;&quot;&quot;</span>
    <span class="n">stripped</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">word_to_strip</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">stripped</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">stripped</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;0&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">url_location_pairs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;https://www.yelp.com/biz/farmers-fridge-chicago-13&#39;</span><span class="p">,</span> <span class="s1">&#39;The Loop 1&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;https://www.yelp.com/biz/farmers-fridge-chicago-14&#39;</span><span class="p">,</span> <span class="s1">&#39;The Loop 2&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;https://www.yelp.com/biz/farmers-fridge-chicago-87&#39;</span><span class="p">,</span> <span class="s2">&quot;O&#39;Hare Airport&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;yelp.csv&#39;</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Determine when to write to a new file or append to existing one</span>
    <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">url_location_pairs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scraping url number </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">scrape_reviews</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">write_to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">reviews</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">write_to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">reviews</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-cleaning-and-exploration">
<h2>Data Cleaning and Exploration<a class="headerlink" href="#data-cleaning-and-exploration" title="Permalink to this headline">¶</a></h2>
<p>Let’s load in the data and examine it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">UnicodeDecodeError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_24568</span><span class="o">/</span><span class="mf">309737772.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp.csv&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>         <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensure_dtype_objs</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">69</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">parsers</span><span class="o">.</span><span class="n">TextReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>             <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/_libs/parsers.pyx</span> in <span class="ni">pandas._libs.parsers.TextReader.__cinit__</span><span class="nt">()</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/_libs/parsers.pyx</span> in <span class="ni">pandas._libs.parsers.TextReader._get_header</span><span class="nt">()</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/_libs/parsers.pyx</span> in <span class="ni">pandas._libs.parsers.TextReader._tokenize_rows</span><span class="nt">()</span>

<span class="nn">~/projects/website/env/lib/python3.7/site-packages/pandas/_libs/parsers.pyx</span> in <span class="ni">pandas._libs.parsers.raise_parser_error</span><span class="nt">()</span>

<span class="ne">UnicodeDecodeError</span>: &#39;utf-8&#39; codec can&#39;t decode byte 0x85 in position 6493: invalid start byte
</pre></div>
</div>
</div>
</div>
<p>The important variables that will be used for this analysis are:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rating</span></code>: an integer rating between 1 (worst) and 5 (best)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">date</span></code>: the date the review was posted on Yelp</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code>: the main contents of the review</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">business_location</span></code>: the location of the fridge</p></li>
</ol>
<p>The others are not used, but some ideas how of how to use them are sketched in § <a class="reference internal" href="#yelp-future"><span class="std std-ref">Future Work</span></a>.</p>
<p>It’s much more convenient to work with datetime objects, so let’s convert them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can easily group reviews by year.
Also grouping by fridge (i.e. business) location, we can count the number of reviews posted at each location in a given year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped_by_year_and_loc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">business_location</span><span class="p">])</span>
<span class="n">annual_counts</span> <span class="o">=</span> <span class="n">grouped_by_year_and_loc</span><span class="o">.</span><span class="n">rating</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">annual_counts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">annual_counts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Number of Annual Reviews&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first Loop location seems to have been one of the first fridges, with reviews available in the same year the company was founded.
The number of reviews per year begins to decline around 2016, coinciding with the opening up of the second Loop location.
In 2017, a fridge location in O’Hare international airport opened up and became relatively popular.
In 2020, when the effects of the COVID-19 pandemic drastically altered lives of Chicago residents, the number of reviews also drastically declined, continuing into 2021.</p>
<p>If we’re interested in annual trends over time, it may helpful to combine the two Loop locations to avoid aggregates from only 5 or fewer reviews:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">combine_loop_locations</span><span class="p">(</span><span class="n">locations</span><span class="p">):</span>
    <span class="n">combined_locations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;The Loop&quot;</span><span class="p">):</span>
            <span class="n">combined_locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The Loop&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">combined_locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">combined_locations</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;combined_location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combine_loop_locations</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">business_location</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">combined_location</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exploratory-data-analysis">
<h2>Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this headline">¶</a></h2>
<p>This section examines a few specific questions, focusing on graphical presentation and inuition rather than formal statistical tests.
These analyses can help inform what avenues Farmer’s Fridge could look into in the future and serve as a foundation for more detailed analyses later.</p>
<div class="section" id="ratings-over-time">
<h3>Ratings Over Time<a class="headerlink" href="#ratings-over-time" title="Permalink to this headline">¶</a></h3>
<p>A plot of annual ratings over time, grouped by location, can be constructed by grouping by the relevant variables and invoking the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method.
In addition, I’ll overlay points with sizes proportional to the number of reviews.
This allows us to quickly weight large points more than small points.
This is important especially for 2020 and 2021 when there is very little data;
for example, the 5/5 rating data for the Loop locations in 2021 is only based on 3 reviews.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">grouped_by_year_and_loc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">combined_location</span><span class="p">])</span>
<span class="n">annual_ratings</span> <span class="o">=</span> <span class="n">grouped_by_year_and_loc</span><span class="o">.</span><span class="n">rating</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">annual_counts</span> <span class="o">=</span> <span class="n">grouped_by_year_and_loc</span><span class="o">.</span><span class="n">rating</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">annual_ratings</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Average Annual Rating (1 to 5)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annual_ratings</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">point_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">annual_counts</span><span class="p">[</span><span class="n">loc</span><span class="p">]]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">annual_ratings</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">annual_ratings</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span>
               <span class="n">s</span><span class="o">=</span><span class="n">point_sizes</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There appears to have been a steady decline in rating throughout 2016.
In 2017, the Loop location’s rating fell substantially but the introduction of the O’Hare location was a success.
The Loop location rebounded somewhat and the O’Hare location continued to see success, until the pandemic hit, drastically lowering the number of ratings available in 2020 and 2021.</p>
</div>
<div class="section" id="what-items-are-popular">
<h3>What Items are Popular?<a class="headerlink" href="#what-items-are-popular" title="Permalink to this headline">¶</a></h3>
<p>A simple analysis assumes a correlation between the number of mentions of an item and its popularity.
I’ve grouped the items like Farmer’s Fridge’s <a class="reference external" href="https://www.farmersfridge.com/menu">website menu</a>, as well as words that are likely to belong in that grouping. Terms synonymous with salad, for example, are</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">salads</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Smoked Cheddar Cobb Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Buffalo Chicken Ranch Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Elote Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;North Napa Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Grilled Chicken Caesar Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Southwest Salad with Chipotle Chicken&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Green Goddess Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Greek Salad&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Salad&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The other groupings are defind as follows:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bowls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Apple Cinnamon Oats&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Falafel Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Pesto Pasta Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Thai Noodle Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Burrito Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Red Chile Braised Pork Bowl by Rick Bayless&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Pineapple Coconut Chia Pudding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Berries &amp; Granola Greek Yogurt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Almond Butter Oats Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Chickpea Tikka Masala&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Chicken Tikka Masala&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Grilled Chicken &amp; Veggie Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Truffle Couscous with Chicken&#39;</span>
    <span class="s1">&#39;Bowl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;oats&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yogurt&#39;</span>
<span class="p">]</span>
<span class="n">sandwiches</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Italian Turkey Wrap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Turkey, Apple &amp; White Cheddar Wrap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Sandwich&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wrap&#39;</span>
<span class="p">]</span>
<span class="n">snacks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;White Cheddar Cheese&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Cookie Dough Bites&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dark Chocolate Trail Mix&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Chips &amp; Guac&#39;</span><span class="p">,</span>
    <span class="s1">&#39;snack&#39;</span><span class="p">,</span>
    <span class="s1">&#39;trail&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dough&#39;</span>
<span class="p">]</span>
<span class="n">proteins</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Falafel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Grilled Chicken&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">drinks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;La Colombe Vanilla Draft Latte&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La Colombe Triple Draft Latte&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Brew Dr. Kombucha Love&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Spindrift Raspberry Lime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;drink&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>With the item groups defined, let’s count unique mentions of each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_item_mentions</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span> <span class="n">item_group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute percentage of times an item in `item_group` is mentioned</span>
<span class="sd">    in a review.&quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">reviews</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_group</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>

<span class="n">item_mention_counts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;salads&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">salads</span><span class="p">),</span>
    <span class="s1">&#39;bowls&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">bowls</span><span class="p">),</span>
    <span class="s1">&#39;sandwiches&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">sandwiches</span><span class="p">),</span>
    <span class="s1">&#39;snacks&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">snacks</span><span class="p">),</span>
    <span class="s1">&#39;proteins&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">proteins</span><span class="p">),</span>
    <span class="s1">&#39;drinks&#39;</span><span class="p">:</span> <span class="n">count_item_mentions</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">drinks</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">item_mention_counts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item_mention_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">item_mention_counts</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Fraction of times mentioned in a review&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Salads are the overwhelming favorite.
Have these trends changed over time?
Below is the annual share for each item type, i.e. the fraction of times an item was mentioned in a review for a given year.
Weighting by total number of reviews that year is again used.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">annual_item_share_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">item_group</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">annual_share</span> <span class="o">=</span> <span class="n">grouped_by_year_and_loc</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="n">count_item_mentions</span><span class="p">,</span> <span class="n">item_group</span><span class="o">=</span><span class="n">item_group</span>
    <span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
    <span class="n">annual_share</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Annual share&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annual_counts</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">point_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">annual_counts</span><span class="p">[</span><span class="n">loc</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">annual_share</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">annual_share</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span>
                   <span class="n">s</span><span class="o">=</span><span class="n">point_sizes</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.6</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">),</span>
                        <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">annual_item_share_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">salads</span><span class="p">,</span> <span class="s1">&#39;Salad Popularity&#39;</span><span class="p">)</span>
<span class="n">annual_item_share_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">bowls</span><span class="p">,</span> <span class="s1">&#39;Bowl Popularity&#39;</span><span class="p">)</span>
<span class="n">annual_item_share_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sandwiches</span><span class="p">,</span> <span class="s1">&#39;Sandwich Popularity&#39;</span><span class="p">)</span>
<span class="n">annual_item_share_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">snacks</span><span class="p">,</span> <span class="s1">&#39;Snack Popularity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Salad popularity has been decreasing, but still has the largest share.
Bowl popularity seems to have the opposite trend, though still have a smaller share.
Sandwiches seem popular at airports, with a sudden drop in 2020 (perhaps due to the pandemic, as sandwiches are not usually eaten with utensils?)
Finally, snacks were initially popular (perhaps because of vending machine familiarity?) but have somewhat declined, except for 2021 where there are only 3 data points.</p>
</div>
<div class="section" id="what-phrases-are-common">
<h3>What Phrases are Common?<a class="headerlink" href="#what-phrases-are-common" title="Permalink to this headline">¶</a></h3>
<p>We can answer this question with more sophisticated language processing.
Using NLKT, the Natural Language Toolkit, we can parse out individual words in a string of unstructured text, or more generally ngrams that contain n words strung together.
Before any of that, let’s define a function that combines all the reviews in the <code class="docutils literal notranslate"><span class="pre">df.text</span></code> column of a dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">combine_review_text</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">review_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">review_text</span> <span class="o">+=</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">3</span>
    <span class="k">return</span> <span class="n">review_text</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">combine_review_text</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="mi">1200</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s import <code class="docutils literal notranslate"><span class="pre">nltk</span></code> and get a list of words.
Technically in language processing terms, we are extracting <em>tokens</em>, since objects like punctuation are retained.
It’s also useful to drop the most common words like “to”, “then”, and “the” using <code class="docutils literal notranslate"><span class="pre">nltk</span></code>’s library of English stop words and convert everything to lowercase for simplicity:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>

<span class="n">stop_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">))</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">filtered_lowercase_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
        <span class="n">filtered_lowercase_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">filtered_lowercase_words</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The result is terse, but the meaning of sentences are maintained.</p>
<p>Now we’re ready to count the most common words and display them.
I’ll define functions for general ngrams for later use.
So even though it is overkill to use a “onegram” for just a list of words we already have, I will for generalizibility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.util</span> <span class="kn">import</span> <span class="n">ngrams</span>

<span class="k">def</span> <span class="nf">count_ngrams</span><span class="p">(</span><span class="n">ngrams</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a dictionary of ngram, count pairs.&quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">ngrams</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">counts</span>

<span class="k">def</span> <span class="nf">sort_dict_by_vals</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sorted_dict</span>

<span class="k">def</span> <span class="nf">print_top_vals</span><span class="p">(</span><span class="n">ngram_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="p">,</span> <span class="n">min_length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print ngrams with at least `min_count` counts and each component</span>
<span class="sd">    exceeds `min_length` in characters.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ngram</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ngram_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">each_elem_is_long_enough</span><span class="p">(</span><span class="n">ngram</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ngram</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">each_elem_is_long_enough</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">min_length</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="n">word_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">word_counts</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">word_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Unsurprisingly, salad is the most common word.
Positive words include “great”, “like”, “delicious”, “healthy”, “good”, and “fresh”.
Because the overall rating across all reviews is high, around 4.3, it’s also unsurprising there are no negative words in the most frequent list.
We can repeat the above for bigrams and trigrams, which are strings of two and three words, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">bigrams</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">bigram_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">trigrams</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">trigram_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These are less informative as they are not positive word plus noun.
Instead, they seem to be names of menu items or expected phrases, like “Farmer’s Fridge” and “vending machine”.</p>
<p>Since most of the reviews are positive, it’s interesting to repeat the ngram analysis for negative reviews only.
Only about 10% of reviews have a rating of 2 or lower.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">negative_text</span> <span class="o">=</span> <span class="n">combine_review_text</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rating</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">negative_text</span><span class="p">)</span>
<span class="n">filtered_lowercase_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
        <span class="n">filtered_lowercase_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="n">filtered_lowercase_words</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>

<span class="n">word_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">word_counts</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">word_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>While we don’t see obvious negative terms like “bad”, we can infer from the given words that these reviewers didn’t like the “prices”, “little” [portions?], [available?] “times”, etc.
Similarly from the bigrams and trigrams,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">bigram_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">bigrams</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">bigram_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">filtered_lowercase_words</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">trigram_counts</span> <span class="o">=</span> <span class="n">sort_dict_by_vals</span><span class="p">(</span><span class="n">count_ngrams</span><span class="p">(</span><span class="n">trigrams</span><span class="p">))</span>
<span class="n">print_top_vals</span><span class="p">(</span><span class="n">trigram_counts</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>we can infer things like these reviewers were not impressed by the salad portions or the vending machine (perhaps they were just not expecting one?).</p>
</div>
</div>
<div class="section" id="future-work">
<span id="yelp-future"></span><h2>Future Work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h2>
<p>These analyses would benefit from more review data and more use of data already collected in reviews.
The Selenium web-scraping approach is very flexible and generalizable.
Future work can automate it to search for all fridge locations in Chicago and scrape all locations with 1 or more reviews.
It is also easy to extend this approach to other cities, like New York City.
I collected lots of metadata, like how many other reviews a given reviewer has posted or whether they’ve obtained the “Elite” Yelp user status.
In addition, it may be useful to take a more detailed look at reviews that have lots of engagement, measured by how many other Yelpers found the review useful, funny, and/or cool.</p>
<p>Additional data could be estimated from the variables collected, for example reviewer sex from an analysis of their names.
This could be useful information if Farmer’s Fridge wanted to better target a particular demographic.
More in depth natural language processing could also be useful to improve the accuracy of the popularity metrics, e.g. salad popularity.
Rather than just looking at if “salad” was mentioned, analyzing the sentiment around that mention would give better information.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "adamwangdata/adamwangdata.github.io",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./stat-ml"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../deploy/churn.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Predicting Churn with Amazon SageMaker</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="forecast.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Time Series Forecasting</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Adam Wang<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>